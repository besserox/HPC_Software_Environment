
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Xavier Besseron">
      
      
        <link rel="canonical" href="https://besserox.github.io/HPC_Software_Environment/testing/">
      
      
        <link rel="prev" href="../software_installation/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Testing on HPC with ReFrame - Master in HPC - HPC Software Environment - Practicals</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing-and-continuous-integration-in-hpc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Master in HPC - HPC Software Environment - Practicals" class="md-header__button md-logo" aria-label="Master in HPC - HPC Software Environment - Practicals" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Master in HPC - HPC Software Environment - Practicals
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing on HPC with ReFrame
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Master in HPC - HPC Software Environment - Practicals" class="md-nav__button md-logo" aria-label="Master in HPC - HPC Software Environment - Practicals" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Master in HPC - HPC Software Environment - Practicals
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../command_line_hpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Environment on HPC
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../compilation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compilation on HPC
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../debugging_profiling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging & Profiling
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../software_installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Software on HPC
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Testing on HPC with ReFrame
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Testing on HPC with ReFrame
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    <span class="md-ellipsis">
      Report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-0-setup" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 0: Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 0: Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-classroom-repository" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub Classroom Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-to-a-compute-node" class="md-nav__link">
    <span class="md-ellipsis">
      Connection to a Compute Node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-getting-started-with-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 1: Getting Started with ReFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 1: Getting Started with ReFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-is-reframe-used-in-wider-cicd-systems" class="md-nav__link">
    <span class="md-ellipsis">
      How is ReFrame used in wider CI/CD systems?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 2: Running tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 2: Running tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-access-to-the-tutorial-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Getting access to the tutorial source code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-sanity-test-for-a-program-compiled-from-source" class="md-nav__link">
    <span class="md-ellipsis">
      Local sanity test for a program compiled from source
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local sanity test for a program compiled from source">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-contents-of-the-test-files" class="md-nav__link">
    <span class="md-ellipsis">
      The contents of the test files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-tests-and-examining-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Running the tests and examining the output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-reframe-output" class="md-nav__link">
    <span class="md-ellipsis">
      Examining ReFrame output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-test-artifacts" class="md-nav__link">
    <span class="md-ellipsis">
      Examining test artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-reports" class="md-nav__link">
    <span class="md-ellipsis">
      Test reports
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-configuring-tests" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 3: Configuring tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 3: Configuring tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-environment-on-a-stand-alone-machine" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the environment on a stand-alone machine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-environment-on-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the environment on a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the environment on a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Executing the tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-compilation-script" class="md-nav__link">
    <span class="md-ellipsis">
      The compilation script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-execution-script" class="md-nav__link">
    <span class="md-ellipsis">
      The execution script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-advanced-sanity-checks" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 4: Advanced sanity checks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 5: Performance testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 5: Performance testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-performance-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Executing performance tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-performance-reference-values" class="md-nav__link">
    <span class="md-ellipsis">
      Adding performance reference values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-integration-with-build-systems" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 6: Integration with build systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 6: Integration with build systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compiling-the-source-code-with-makefile-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling the source code with Makefile scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling-with-source-code-package-manager-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling with source code package manager systems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#report-submission" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Report submission
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Additional Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Additional Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      About ReFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#about-python-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      About Python Regular Expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Introduction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Objectives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Instructions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#report" class="md-nav__link">
    <span class="md-ellipsis">
      Report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-0-setup" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 0: Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 0: Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-classroom-repository" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub Classroom Repository
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-to-a-compute-node" class="md-nav__link">
    <span class="md-ellipsis">
      Connection to a Compute Node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-getting-started-with-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 1: Getting Started with ReFrame
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 1: Getting Started with ReFrame">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-is-reframe-used-in-wider-cicd-systems" class="md-nav__link">
    <span class="md-ellipsis">
      How is ReFrame used in wider CI/CD systems?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 2: Running tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 2: Running tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-access-to-the-tutorial-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Getting access to the tutorial source code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-sanity-test-for-a-program-compiled-from-source" class="md-nav__link">
    <span class="md-ellipsis">
      Local sanity test for a program compiled from source
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Local sanity test for a program compiled from source">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-contents-of-the-test-files" class="md-nav__link">
    <span class="md-ellipsis">
      The contents of the test files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-tests-and-examining-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Running the tests and examining the output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-reframe-output" class="md-nav__link">
    <span class="md-ellipsis">
      Examining ReFrame output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examining-test-artifacts" class="md-nav__link">
    <span class="md-ellipsis">
      Examining test artifacts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-reports" class="md-nav__link">
    <span class="md-ellipsis">
      Test reports
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-3-configuring-tests" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 3: Configuring tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 3: Configuring tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-environment-on-a-stand-alone-machine" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the environment on a stand-alone machine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-the-environment-on-a-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring the environment on a cluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuring the environment on a cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-the-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Executing the tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-compilation-script" class="md-nav__link">
    <span class="md-ellipsis">
      The compilation script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-execution-script" class="md-nav__link">
    <span class="md-ellipsis">
      The execution script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-4-advanced-sanity-checks" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 4: Advanced sanity checks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-5-performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 5: Performance testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 5: Performance testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#executing-performance-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Executing performance tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-performance-reference-values" class="md-nav__link">
    <span class="md-ellipsis">
      Adding performance reference values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-6-integration-with-build-systems" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Part 6: Integration with build systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Part 6: Integration with build systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#compiling-the-source-code-with-makefile-scripts" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling the source code with Makefile scripts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compiling-with-source-code-package-manager-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Compiling with source code package manager systems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#report-submission" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Report submission
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      ðŸ”µ Additional Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ”µ Additional Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-reframe" class="md-nav__link">
    <span class="md-ellipsis">
      About ReFrame
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#about-python-regular-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      About Python Regular Expressions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="testing-and-continuous-integration-in-hpc">Testing and Continuous Integration in HPC</h1>
<ul>
<li>Author: Georgios Kafanas (<a href="https://uni.lu/">University of Luxembourg</a>), <a href="https://luxdem.uni.lu/team/xbesseron/">Xavier Besseron</a> (<a href="https://uni.lu/">University of Luxembourg</a>)</li>
<li>License: Â©2024 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></li>
<li>Date of practical: Tuesday 19th of March 2024</li>
</ul>
<h2 id="introduction">ðŸ”µ Introduction</h2>
<p>Welcome to our practical session on the testing of scientific software on HPC.
HPC environments are essential for large-scale simulations and computationally intensive research.
Understanding how to install the necessary tools correctly is a vital skill for the efficient use of these powerful resources.</p>
<p>In this practical session, we're diving into the world of testing within HPC environments.<br />
HPC systems bring incredible power, but also unique challenges when ensuring our software and simulations are reliable and accurate.
When dealing with critical calculations, from scientific breakthroughs to engineering designs, errors here can also have costly consequences. 
That's why robust testing strategies tailored to HPC are essential.</p>
<h3 id="objectives">Objectives</h3>
<p>This practical will focus on the ReFrame testing framework. 
ReFrame is a powerful tool for writing system regression tests and benchmarks, designed to run tests on HPC systems, but also supporting a wide range of platforms. 
The goal of the framework is to separate the logic of the tests from the configuration required to run the tests in each HPC cluster. 
Therefore, a single set of tests can be easily executed in a set of clusters by describing a configuration for each cluster.</p>
<p>In this session, we will cover the execution and analysis of</p>
<ul>
<li><strong>sanity</strong> and <strong>performance</strong> tests,</li>
<li>that run either <strong>locally</strong> or on an <strong>HPC cluster</strong> component,</li>
<li>on programs that are either <strong>compiled from source</strong> or <strong>installed using a build automation framework</strong>, such as EasyBuild.</li>
</ul>
<p>The exercises will also refer to external documentation and instructions that need to be consulted. 
The aim is for you to be independent and work in 'real conditions' by finding the information you need to complete the tasks.</p>
<h3 id="instructions">Instructions</h3>
<p>This practical is an <strong>individual work</strong> to be carried out on the <strong>Aion cluster</strong> of the HPC platform of the University of Luxembourg.</p>
<p>It is composed of different elements:</p>
<ul>
<li>this page that contains <strong>instructions and questions</strong>;</li>
<li>the <strong>GitHub Classroom repository</strong> that contains the materials for the exercises;</li>
<li>the <strong>report</strong> that you have to submit via GitHub Classroom with the rest of the requested documents</li>
</ul>
<h3 id="report">Report</h3>
<p>Together with this tutorial, you need to prepare a short report of your work:</p>
<ul>
<li>There is no template, you can start from a blank document. Keep it simple, clear and well-organized.</li>
<li>Make sure you answer all the questions (cf below), with text, code or screenshots as requested.</li>
<li>Prepare your report at the same time you're doing the exercises.</li>
<li>Submit your report as a PDF file to your GitHub Classroom repository and <strong>push it before the deadline</strong>.</li>
</ul>
<div class="admonition question">
<p class="admonition-title">Question 0: What? Who? When?</p>
<p>Indicate at the beginning of your report:</p>
<ul>
<li>the title of the practical</li>
<li>your full name</li>
<li>your Uni.lu HPC username</li>
<li>your GitHub username</li>
<li>the date</li>
</ul>
</div>
<hr />
<h2 id="part-0-setup">ðŸ”µ Part 0: Setup</h2>
<h3 id="github-classroom-repository">GitHub Classroom Repository</h3>
<p>Following the same approach as the previous practicals,
this practical relies on Git Classroom to distribute the extra materials and for the submission of the report.
To create your copy of the repository, follow the invitation link and accept the assignment:</p>
<p>Assignment link: <a href="https://classroom.github.com/a/AeZ54-FZ">https://classroom.github.com/a/AeZ54-FZ</a></p>
<p>If you need detailed explanations, please refer to the first week's instructions for <a href="../command_line_hpc/#part-3-setting-up-git-and-downloading-the-materials">Setting up Git and downloading the materials</a>.</p>
<h3 id="connection-to-a-compute-node">Connection to a Compute Node</h3>
<p>The exercises are to be carried out in interactive mode on a compute node of the <strong>Aion cluster</strong> of the University of Luxembourg.</p>
<p>As a reminder, here are the steps to access a compute nodes:</p>
<ul>
<li>Connect to the access node of the Aion cluster (cf <a href="../command_line_hpc/#connection-to-hpc-access">Connection to HPC Access</a>)</li>
<li>Find your reservation, if application (cf <a href="../command_line_hpc/#finding-your-reservation">Finding your reservation</a>)</li>
<li>Connect to a compute node (cf <a href="../command_line_hpc/#connection-to-a-compute-node">Connection to a compute node</a>)</li>
</ul>
<details class="tip">
<summary>Recommended Settings</summary>
<p>For this practical session, the following options are suggested:</p>
<ul>
<li>Partition: <code>interactive</code></li>
<li>QoS: <code>debug</code></li>
<li>Reservation: <code>hpc_software_d19</code> during the Tuesday afternoon session</li>
<li>Time: 2 hours (or ending before the end of the reservation)</li>
<li>Node: One compute node</li>
<li>Tasks: One task</li>
<li>Cores: 32 cores per task</li>
</ul>
</details>
<p>Your access command line should look like this:</p>
<div class="highlight"><pre><span></span><code>salloc<span class="w"> </span>-p<span class="w"> </span>interactive<span class="w"> </span>--qos<span class="w"> </span>debug<span class="w"> </span>--reservation<span class="o">=</span>hpc_software_d19<span class="w"> </span>--time<span class="o">=</span><span class="m">2</span>:00:00<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span>-c<span class="w"> </span><span class="m">32</span>
</code></pre></div>
<h2 id="part-1-getting-started-with-reframe">ðŸ”µ Part 1: Getting Started with ReFrame</h2>
<h3 id="how-is-reframe-used-in-wider-cicd-systems">How is ReFrame used in wider CI/CD systems?</h3>
<p>ReFrame is one of the components of automated CI/CD systems that is particularly important in HPC. The ReFrame framework provides a simple API that can be used by automated CI/CD systems, such as <a href="https://www.jenkins.io/">Jenkins</a> to launch tests. Tests can be triggered</p>
<ul>
<li>at specific events during software development, such push of new commits in a development branch, or before a new release;</li>
<li>at specific events during the management of a cluster, such as the update of software or installation of new hardware;</li>
<li>at regular time intervals as a catch-all measure.</li>
</ul>
<p>ReFrame does not control the launching of tests, but it will make sure that each test runs on all relevant systems. The figure below summarizes the set of logical decisions that ReFrame uses for each test specification to determine if a test has run for a given system and environment.</p>
<figure>
  <img alt="The Regression Test Loop" class="center" src="../images/the_regression_test_loop.png" />
  <figcaption>Figure 1: The regression test loop in ReFrame</figcaption>
</figure>
<p>Of course, ReFrame tests can also be launched manually as well. Even with automation, there are tests you should run always manually: You don't want to run cluster-wide stress tests without supervision!</p>
<h3 id="installation">Installation</h3>
<p>ReFrame is available in our cluster as a module. However, for instructive purposes, install and configure the latest module for ReFrame from scratch, as someone would in a new system.</p>
<details class="info">
<summary>Install the latest EasyBuild</summary>
<p>If you have not done so during the last practical session, you need to install the latest EasyBuild first.
You can follow the instructions of the <a href="../software_installation/#installingupgrading-easybuild">previous practical session on Software Installation</a>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Load the current EasyBuild</span>
module<span class="w"> </span>load<span class="w"> </span>tools/EasyBuild/4.5.4
<span class="c1"># Install the latest EasyBuild</span>
eb<span class="w"> </span>--install-latest-eb-release
</code></pre></div>
</details>
<details class="info">
<summary>Set up your module search path</summary>
<p>To find the software and modules installed in your home directory, you need to update your module search path <code>MODULEPATH</code>
If you have not done it during the last practical sessions,
you can follow the instructions of the <a href="../software_installation/#easybuild-initial-configuration">previous practical session on Software Installation</a>.</p>
<p>To make the software installed by EasyBuild searchable with module in the current shell, run this command:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Update Lmod search path</span>
module<span class="w"> </span>use<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">EASYBUILD_PREFIX</span><span class="si">}</span><span class="s2">/modules/all&quot;</span>
</code></pre></div>
<p>To make the software installed by EasyBuild searchable with module permanently (<strong>recommended</strong>),
add the following lines at the end of your <code>~/.bashrc</code> file:</p>
<div class="highlight"><pre><span></span><code># Include the EasyBuild installation path to the Lmod search path
if command -v module &gt;/dev/null 2&gt;&amp;1 ; then
  module use &quot;${EASYBUILD_PREFIX}/modules/all&quot;
fi
</code></pre></div>
</details>
<p>A simple way to install ReFrame is using EasyBuild. Search with EasyBuild for the readily available ReFrame easyconfigs.
<div class="highlight"><pre><span></span><code><span class="c1"># Use the latest EasyBuild</span>
$<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>tools/EasyBuild/4.9.0
<span class="c1"># Search for ReFrame recipe</span>
$<span class="w"> </span>eb<span class="w"> </span>-S<span class="w"> </span><span class="nv">reframe</span>
<span class="o">==</span><span class="w"> </span>found<span class="w"> </span>valid<span class="w"> </span>index<span class="w"> </span><span class="k">for</span><span class="w"> </span>/home/users/username/environments/easybuild/easybuild/easyconfigs,<span class="w"> </span>so<span class="w"> </span>using<span class="w"> </span>it...
<span class="nv">CFGS1</span><span class="o">=</span>/home/users/username/environments/easybuild/easybuild/easyconfigs/r/ReFrame
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-2.18.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-2.19.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-2.20.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-2.21.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.2.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.3.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.4.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.5.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.5.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.5.2.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.6.2.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.6.3.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.7.3.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.8.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.9.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.9.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.10.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.11.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.11.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.11.2.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-3.12.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-4.0.1.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-4.0.5.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-4.2.0.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-4.3.2.eb
<span class="w"> </span>*<span class="w"> </span><span class="nv">$CFGS1</span>/ReFrame-4.3.3.eb
</code></pre></div>
There are multiple recipes available. Install the latest available version.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>eb<span class="w"> </span>ReFrame-4.3.3.eb
</code></pre></div></p>
<p>After the installation, ReFrame should be available as a module at the cluster nodes. Start a job at a compute node, add the directory where your EasyBuild configuration installed the module files to the module search path, and you should be able to load ReFrame with the command
<div class="highlight"><pre><span></span><code>module<span class="w"> </span>load<span class="w"> </span>devel/ReFrame/4.3.3
</code></pre></div>
as with any other software.</p>
<hr />
<h2 id="part-2-running-tests">ðŸ”µ Part 2: Running tests</h2>
<p>Quite often you want to test software which you compile from source, for instance, because you are a developer on some project. In this section, we start with simple test programs compiled directly from source, and create sanity and performance tests. We then port our tests in the UL HPC Aion cluster.</p>
<h3 id="getting-access-to-the-tutorial-source-code">Getting access to the tutorial source code</h3>
<p>The tutorial follows closely the <a href="https://reframe-hpc.readthedocs.io/en/stable/tutorial_basics.html">official ReFrame tutorials</a>. The source code for the official tutorials is included in the <a href="https://github.com/reframe-hpc/reframe.git">source distribution of ReFrame</a>. We have made some modifications to the source code so that it runs in our Aion cluster. You can find the modified tutorials in the assignment repository in the <code>tutorials</code> directory.</p>
<div class="admonition warning">
<p class="admonition-title">Tutorial files</p>
<p>All subsequent filenames are referenced relative to the <code>tutorials</code> directory of your GitHub Classroom repository.</p>
</div>
<h3 id="local-sanity-test-for-a-program-compiled-from-source">Local sanity test for a program compiled from source</h3>
<p>As a first example we will test with ReFrame that a "Hello, World!" program produces the desired output. Tests in ReFrame are organized in directories. The test directory is <code>basics/hello</code>. Printing out the test directory structure,
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>basics/hello
basics/hello
â”œâ”€â”€<span class="w"> </span>hello1.py
â”œâ”€â”€<span class="w"> </span>hello2.py
â””â”€â”€<span class="w"> </span>src
<span class="w">    </span>â”œâ”€â”€<span class="w"> </span>hello.c
<span class="w">    </span>â””â”€â”€<span class="w"> </span>hello.cpp

<span class="m">1</span><span class="w"> </span>directory,<span class="w"> </span><span class="m">4</span><span class="w"> </span>files
</code></pre></div>
there is a subdirectory, <code>src</code>, with the source code, and 2 Python files.</p>
<ul>
<li>The <code>src</code> directory is where ReFrame will look for source code files by default. You can customize the source code directory name.</li>
<li>The Python files contain our test specifications. ReFrame is a Python framework, meaning that our tests simply modify the behavior of the Python scripts running the tests. We can use all the features of Python language when specifying our tests.</li>
</ul>
<p>Let's have a look at the first test file, <code>basics/hello/hello1.py</code>.
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">reframe</span> <span class="k">as</span> <span class="nn">rfm</span>
<span class="kn">import</span> <span class="nn">reframe.utility.sanity</span> <span class="k">as</span> <span class="nn">sn</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">HelloTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">sourcepath</span> <span class="o">=</span> <span class="s1">&#39;hello.c&#39;</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, World\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="the-contents-of-the-test-files">The contents of the test files</h4>
<p>This test concerns a single source file, <code>hello.c</code>, defined in the <a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.sourcepath"><code>sourcepath</code></a> option. All source paths provided are relative to the <code>src</code> directory by default. In fact, there are multiple test options that do not appear here because they use their default values. You can find details on how to customize the build options in the <a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#build-systems">Build Systems</a> section of the API. A few source code options that are often useful are</p>
<ul>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.buildsystems.Make.srcdir"><code>srcdir</code></a>, which defines a custom source directory, and</li>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.build_system"><code>build_system</code></a>, which determines the type of build system used to compile the code.</li>
</ul>
<p>The <code>build_system</code> can determine that a single source file is compiled (<code>SingleSource</code>), that some build automation system is used (such as Make, CMake, and Autotools) or that some source code package manager such as EasyBuild and Spack is used. The value of <code>build_system</code> is often determined automatically from the contents of <code>src</code>. However, on some occasions, like when both Make and CMake compilation scripts are available, you may have to specify the build system. In our case where we compile single files, the <code>'SingleSource'</code> option, which is the default, is used.</p>
<p>We set 2 more variables explicitly in our test file.</p>
<ul>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.valid_prog_environs"><code>valid_prog_environs</code></a>: sets valid programming environments. These are a collection of compilation options, including the compiler for each language, compilation flags, and procedural options, such as the number of cores used for the compilation and whether we compile locally or submit a job at the cluster.</li>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/regression_test_api.html#reframe.core.pipeline.RegressionTest.valid_systems"><code>valid_systems</code></a>: sets the systems for which our test is valid. For instance, in our case, it can be a single Aion node or the whole Aion cluster.</li>
</ul>
<p>The environment and system components are specified in configuration files. If we do not provide a configuration file, then ReFrame will use default options. Assigning the <code>'*'</code> argument for some component means that our test will be executed for all instances specified for that component in our configuration files.</p>
<div class="admonition tips">
<p class="admonition-title">Test options configuration</p>
<p>All configuration options are defined in Python dictionaries in configuration Python files. Options are set in test files by assigning the appropriate field of the test class to a list of dictionary keys.</p>
</div>
<p>The test file defines a single sanity check on the output of the compiled program. The test is defined in a class, <code>HelloTest</code>, which inherits from <code>reframe.RegressionTest</code> class and decorated with the <code>@rfm.simple_test</code> decorator. The <code>rfm.RegressionTest</code> class of tests analyzes the output of the compiled executable and the <code>@rfm.simple_test</code> registers the <code>HelloTest</code> as a test. There are types of tests for checking various kinds of output streams, such as compilation warnings and errors. The test defines a single sanity check function, <code>assert_hello</code>, which looks for the existence of the "Hello, World!" string in the standard output (<code>stdout</code>) of our program. The decorator <code>@rfm.simple_test</code> registers the <code>assert_hello</code> function as a function which will provide a test.</p>
<ul>
<li>The ReFrame framework makes extensive use of <a href="https://peps.python.org/pep-0318/">decorators</a> to define tests and other actions.</li>
<li>The special class of lazily evaluated function, the <a href="https://reframe-hpc.readthedocs.io/en/stable/deferrables.html">Deferrable Functions</a>, is defined in <code>reframe.utility.sanity</code>. These functions are used to provide expression which will be evaluated on the output of programs when running the tests. The <code>assert_found</code> used in our sanity check is an instance of this class of functions.</li>
</ul>
<div class="admonition tips">
<p class="admonition-title">Composing deferrable functions</p>
<p>You don't need to know the details of how deferrable functions work, just that they specify the computation of an expression that will be evaluated later when tests are run. You will need to convert your tests to expressions using deferrable functions.</p>
<p>The <a href="https://reframe-hpc.readthedocs.io/en/stable/deferrable_functions_reference.html">documentation</a> of the deferrable functions module (<code>reframe.utility.sanity</code>) should provide all the information you need.</p>
</div>
<h4 id="running-the-tests-and-examining-the-output">Running the tests and examining the output</h4>
<p>Run the tests by issuing a command to ReFrame with the path to the file with the tests (<code>--checkpath</code>) and the command to run the test (<code>--run</code>) as arguments.
<div class="highlight"><pre><span></span><code>$ reframe --checkpath basics/hello/hello1.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --checkpath basics/hello/hello1.py --run&#39;
  launched by:       gkafanas@aion-0096
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello/hello1.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-0ldxr9w8.log&#39;

[==========] Running 1 check(s)
[==========] Started on Thu Mar  7 14:42:37 2024

[----------] start processing checks
[ RUN      ] HelloTest /2b3e4546 @generic:default+builtin
[       OK ] (1/1) HelloTest /2b3e4546 @generic:default+builtin
[----------] all spawned checks have finished

[  PASSED  ] Ran 1/1 test case(s) from 1 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Thu Mar  7 14:42:37 2024
Log file(s) saved in &#39;/tmp/rfm-0ldxr9w8.log&#39;
</code></pre></div></p>
<p>Observe the output. ReFrame has run the test and reports</p>
<ul>
<li>the <strong>stage directory</strong> where the test where run,</li>
<li>the <strong>output directory</strong> where the test output was stored,</li>
<li>the <strong>check search path</strong> which is the path to the file containing the tests that were run, and</li>
<li>that a detailed log of all the operations performed is saved in a temporary <strong>log file</strong>.</li>
</ul>
<p>You can explore these different paths and files to understand better how ReFrame works.</p>
<div class="admonition question">
<p class="admonition-title">Question 1: Locating test output artifacts</p>
<p>Take a screenshot of the ReFrame output ðŸ“¸ and include it in your report.</p>
<p>In your report, write down the following information:</p>
<ul>
<li>the path to the stage directory,</li>
<li>the path to the output directory,</li>
<li>the path to the file from which the tests were selected and run, and</li>
<li>the path to the log file.</li>
</ul>
</div>
<h4 id="examining-reframe-output">Examining ReFrame output</h4>
<p>The regression tests are executed in a few distinct phases summarized in Figure 2.</p>
<figure>
  <img alt="Regression test pipeline" src="../images/the_regression_test_pipeline.png" width="800" />
  <figcaption>Figure 2: The regression test pipeline in ReFrame</figcaption>
</figure>
<p>We can discern a few of these steps in the output of ReFrame. The report mentions each test run, for instance
<div class="highlight"><pre><span></span><code>[ RUN      ] HelloTest /2b3e4546 @generic:default+builtin
</code></pre></div>
and a summary of the test results, for instance:
<div class="highlight"><pre><span></span><code>[       OK ] (1/1) HelloTest /2b3e4546 @generic:default+builtin
</code></pre></div>
Each report line begins with the test name (e.g. <code>HelloTest</code>) together with a unique hash for the test configuration (e.g. <code>2b3e4546</code>). The second part of the test description is:
<div class="highlight"><pre><span></span><code>@generic:default+builtin
</code></pre></div>
This string describes the configuration of the system where the test is compiled and run. The general form of the system configuration string is
<div class="highlight"><pre><span></span><code>@system:partition+environment
</code></pre></div>
where</p>
<ul>
<li><code>system</code> is a name identifying the configuration where our test was compiled and run, a system can contain multiple <em>partitions</em> and <em>configurations</em>,</li>
<li><code>partition</code> is a description of how the test was run, in HPC systems this description can include options like the scheduler partition where the tests will be launched (hence the name) and required modules, and</li>
<li><code>environment</code> is a description of how the test was compiled, including compilation flags and runtime options like the number of threads available to the compiler.</li>
</ul>
<div class="admonition tips">
<p class="admonition-title">Compilation location</p>
<p>ReFrame compiles the source code locally, on the system where ReFrame is launched. The <code>partition</code> setting applies only to the tests. In an HPC system with a scheduler, you can thus submit multiple tests for the same executable to be run in parallel. If you want to compile and test multiple programs in parallel you have to launch multiple ReFrame jobs.</p>
</div>
<p>The system configuration options are defined in configuration files (introduced later). The simple hello test uses the default options since no configuration file is specified when running ReFrame.</p>
<div class="admonition question">
<p class="admonition-title">Question 2: Locating the test pipeline phases in the log file</p>
<p>The temporary log file contains detailed output for the test phase. Attach a copy of your log file to your report repository, and mention in your report in which line each test phase starts.</p>
</div>
<h4 id="examining-test-artifacts">Examining test artifacts</h4>
<p>The execution of the tests generates a few artifacts. These artifacts are stored in the <code>output</code> and <code>stage</code> directories created in the directory where ReFrame is launched. If you examine the output directory, it should contain the subdirectory
<div class="highlight"><pre><span></span><code>output/generic/default/builtin/HelloTest
</code></pre></div>
where the various directory names in the path also appear in the <em>test configuration</em> string. This directory contains the following files:
<div class="highlight"><pre><span></span><code>$ ls output/generic/default/builtin/HelloTest
rfm_build.err  rfm_build.out  rfm_build.sh  rfm_job.err  rfm_job.out  rfm_job.sh
</code></pre></div></p>
<p>Let's have a look at the contents of the output files:</p>
<ul>
<li><code>rfm_build.sh</code> is a Bash script that compiles the test executable
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

_onerror<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span><span class="nv">exitcode</span><span class="o">=</span><span class="nv">$?</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;-reframe: command \`</span><span class="nv">$BASH_COMMAND</span><span class="s2">&#39; failed (exit code: </span><span class="nv">$exitcode</span><span class="s2">)&quot;</span>
<span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="nv">$exitcode</span>
<span class="o">}</span>

<span class="nb">trap</span><span class="w"> </span>_onerror<span class="w"> </span>ERR

cc<span class="w"> </span>hello.c<span class="w"> </span>-o<span class="w"> </span>./HelloTest
</code></pre></div></li>
<li><code>rfm_build.out</code> and <code>rfm_build.err</code> contain the <em>standard output</em> and <em>error output</em> of the test compilation.</li>
<li><code>rfm_job.sh</code> is a Bash script that runs the test executable.
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
./HelloTest
</code></pre></div></li>
<li><code>rfm_job.out</code> and <code>rfm_job.err</code> contain the <em>standard output</em> and <em>error output</em> of the test execution.</li>
</ul>
<p>In this case, the contents of <code>rfm_job.out</code> are of particular interest, since they are analyzed by our sanity check.
It contains a single line with the string <code>'Hello, World!'</code>. Our regression test defined with <code>sn.assert_found(r'Hello, World\!', self.stdout)</code> simply checks for the existence of the string <code>'Hello, World!'</code> in the output file, so it will succeed.</p>
<p>If later a change is introduced to our program and it produces the output
<div class="highlight"><pre><span></span><code>Hello, World!
123
</code></pre></div>
the regression test will still succeed!
Of course, it is possible to use more sophisticated checks to catch such regressions, and they will be presented in the next sections.</p>
<p>The contents of the <code>stage</code> directory have the same subdirectory structure as the <code>output</code> directory, but for a successful test, it will be empty. The stage directory is used to compile and run the code. During the test, the contents of the test directory <code>basics/hello</code> are transferred to the staging directory, and the code is compiled and executed. After a successful test, the contents of the staging directory are cleared. However, after a failed test the contents of the staging directory are retained so that you can diagnose the cause of the failure.</p>
<div class="admonition info">
<p class="admonition-title">Keeping the test output</p>
<p>You can change the default option of deleting the staged files upon successful completion of a test with the flag <code>--keep-staged-files</code>.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Question 3: Locating test artifacts</p>
<p>Change the "Hello, World!" example to print to standard error instead of standard output. This is accomplished by replacing
<div class="highlight"><pre><span></span><code><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</code></pre></div>
with:
<div class="highlight"><pre><span></span><code><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, World!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</code></pre></div>
What are the contents of the <em>output</em> and <em>stage</em> directories now? Note down the list of files in each directory in your report.</p>
</div>
<h4 id="test-reports">Test reports</h4>
<p>ReFrame also saves the setup and output of each test as a <strong>test report</strong> in JSON format in the directory <code>~/.reframe/reports/</code>. Running <code>tree</code> after executing a single test, we get:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>~/.reframe/reports
/home/users/gkafanas/.reframe/reports
â”œâ”€â”€<span class="w"> </span>latest.json<span class="w"> </span>-&gt;<span class="w"> </span>run-report-0.json
â””â”€â”€<span class="w"> </span>run-report-0.json

<span class="m">0</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">2</span><span class="w"> </span>files
</code></pre></div>
<p>We see a list of all the run reports and a symbolic link to the latest report. Not that ReFrame will not clean the report directory <code>~/.reframe/reports</code> for you!</p>
<div class="admonition info">
<p class="admonition-title">Redirecting the report output</p>
<p>If you want ReFrame to print the report in a specific file use the flag <code>--report-file &lt;FILE&gt;</code>.</p>
</div>
<p>The report files contain all the information printed in the <code>stdout</code> by ReFrame, but also a lot more detail. In particular, any default options are listed explicitly. You can use the report files to browse the options available for your test configurations.</p>
<details class="info">
<summary>Example report file</summary>
<p>For instance, the report for the "Hello, World!" test contains the following:
<div class="highlight"><pre><span></span><code>{
  &quot;session_info&quot;: {
    &quot;cmdline&quot;: &quot;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --checkpath basics/hello/hello1.py --run&quot;,
    &quot;config_files&quot;: [
      &quot;&lt;builtin&gt;&quot;
    ],
    &quot;data_version&quot;: &quot;3.1&quot;,
    &quot;hostname&quot;: &quot;aion-0096&quot;,
    &quot;log_files&quot;: [
      &quot;/tmp/rfm-98ae7dcg.log&quot;
    ],
    &quot;prefix_output&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&quot;,
    &quot;prefix_stage&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&quot;,
    &quot;user&quot;: &quot;gkafanas&quot;,
    &quot;version&quot;: &quot;4.3.3&quot;,
    &quot;workdir&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&quot;,
    &quot;time_start&quot;: &quot;2024-03-07T14:55:45+0100&quot;,
    &quot;time_end&quot;: &quot;2024-03-07T14:55:46+0100&quot;,
    &quot;time_elapsed&quot;: 0.5394518375396729,
    &quot;num_cases&quot;: 1,
    &quot;num_failures&quot;: 0
  },
  &quot;runs&quot;: [
    {
      &quot;num_cases&quot;: 1,
      &quot;num_failures&quot;: 0,
      &quot;num_aborted&quot;: 0,
      &quot;num_skipped&quot;: 0,
      &quot;runid&quot;: 0,
      &quot;testcases&quot;: [
        {
          &quot;build_stderr&quot;: &quot;rfm_build.err&quot;,
          &quot;build_stdout&quot;: &quot;rfm_build.out&quot;,
          &quot;dependencies_actual&quot;: [],
          &quot;dependencies_conceptual&quot;: [],
          &quot;description&quot;: &quot;&quot;,
          &quot;display_name&quot;: &quot;HelloTest&quot;,
          &quot;environment&quot;: &quot;builtin&quot;,
          &quot;fail_phase&quot;: null,
          &quot;fail_reason&quot;: null,
          &quot;filename&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello/hello1.py&quot;,
          &quot;fixture&quot;: false,
          &quot;hash&quot;: &quot;2b3e4546&quot;,
          &quot;jobid&quot;: &quot;4124802&quot;,
          &quot;job_stderr&quot;: &quot;rfm_job.err&quot;,
          &quot;job_stdout&quot;: &quot;rfm_job.out&quot;,
          &quot;maintainers&quot;: [],
          &quot;name&quot;: &quot;HelloTest&quot;,
          &quot;nodelist&quot;: [
            &quot;aion-0096&quot;
          ],
          &quot;outputdir&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output/generic/default/builtin/HelloTest&quot;,
          &quot;perfvars&quot;: null,
          &quot;prefix&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello&quot;,
          &quot;result&quot;: &quot;success&quot;,
          &quot;stagedir&quot;: &quot;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage/generic/default/builtin/HelloTest&quot;,
          &quot;scheduler&quot;: &quot;local&quot;,
          &quot;system&quot;: &quot;generic:default&quot;,
          &quot;tags&quot;: [],
          &quot;time_compile&quot;: 0.1687169075012207,
          &quot;time_performance&quot;: 0.00466609001159668,
          &quot;time_run&quot;: 0.16573643684387207,
          &quot;time_sanity&quot;: 0.0048558712005615234,
          &quot;time_setup&quot;: 0.05423617362976074,
          &quot;time_total&quot;: 0.49439144134521484,
          &quot;unique_name&quot;: &quot;HelloTest&quot;,
          &quot;check_vars&quot;: {
            &quot;valid_prog_environs&quot;: [
              &quot;*&quot;
            ],
            &quot;valid_systems&quot;: [
              &quot;*&quot;
            ],
            &quot;descr&quot;: &quot;&quot;,
            &quot;sourcepath&quot;: &quot;hello.c&quot;,
            &quot;sourcesdir&quot;: &quot;src&quot;,
            &quot;prebuild_cmds&quot;: [],
            &quot;postbuild_cmds&quot;: [],
            &quot;executable&quot;: &quot;./HelloTest&quot;,
            &quot;executable_opts&quot;: [],
            &quot;prerun_cmds&quot;: [],
            &quot;postrun_cmds&quot;: [],
            &quot;keep_files&quot;: [],
            &quot;readonly_files&quot;: [],
            &quot;tags&quot;: [],
            &quot;maintainers&quot;: [],
            &quot;strict_check&quot;: true,
            &quot;num_tasks&quot;: 1,
            &quot;num_tasks_per_node&quot;: null,
            &quot;num_gpus_per_node&quot;: null,
            &quot;num_cpus_per_task&quot;: null,
            &quot;num_tasks_per_core&quot;: null,
            &quot;num_tasks_per_socket&quot;: null,
            &quot;use_multithreading&quot;: null,
            &quot;max_pending_time&quot;: null,
            &quot;exclusive_access&quot;: false,
            &quot;local&quot;: false,
            &quot;modules&quot;: [],
            &quot;env_vars&quot;: {},
            &quot;variables&quot;: {},
            &quot;time_limit&quot;: null,
            &quot;build_time_limit&quot;: null,
            &quot;extra_resources&quot;: {},
            &quot;build_locally&quot;: true
          },
          &quot;check_params&quot;: {}
        }
      ]
    }
  ],
  &quot;restored_cases&quot;: []
}
</code></pre></div></p>
<p>We can find the options for</p>
<ul>
<li><code>valid_prog_environs</code>,</li>
<li><code>valid_systems</code>,</li>
<li><code>sourcepath</code>,</li>
</ul>
<p>and many more options and output results.</p>
</details>
<div class="admonition question">
<p class="admonition-title">Question 4: Analysing report files</p>
<p>The ReFrame report file contains all the setup and output information for a test.</p>
<p>Run the original "Hello, World!" test again, locate the ReFrame report and add it to your GitHub Classroom repository.
In the report file note down the lines containing</p>
<ul>
<li>the <code>valid_prog_environs</code> and <code>valid_systems</code> options defined in the <code>HelloTest</code> class,</li>
<li>the <code>sourcedir</code> option,</li>
<li>the <em>stage</em> and <em>output</em> directory paths,</li>
<li>the hash for the test, and</li>
<li>the result of the test.</li>
</ul>
</div>
<hr />
<h2 id="part-3-configuring-tests">ðŸ”µ Part 3: Configuring tests</h2>
<p>Test configuration files set up the environment and provide options for the compilation and execution of tested programs. Let's start by investigating a simple case where a configuration file is required. Consider the test case in <code>basics/hello/hello2.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">reframe</span> <span class="k">as</span> <span class="nn">rfm</span>
<span class="kn">import</span> <span class="nn">reframe.utility.sanity</span> <span class="k">as</span> <span class="nn">sn</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">HelloMultiLangTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
    <span class="n">lang</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;cpp&#39;</span><span class="p">])</span>

    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_sourcepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourcepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;hello.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lang</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, World\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
<p>There are 2 differences from our original "Hello, World!" test,</p>
<ul>
<li>the definition of the source files in <code>sourcepath</code> is now inside the function <code>set_sourcepath</code>, and</li>
<li>there is an extra parameter <code>lang</code>.</li>
</ul>
<p>The sanity test remains the same. Try running the tests defined in <code>basics/hello/hello2.py</code>.</p>
<div class="highlight"><pre><span></span><code>$ reframe --checkpath basics/hello/hello2.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --checkpath basics/hello/hello2.py --run&#39;
  launched by:       gkafanas@aion-0163
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello/hello2.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-myh24uz1.log&#39;

[==========] Running 2 check(s)
[==========] Started on Fri Mar  8 13:42:48 2024

[----------] start processing checks
[ RUN      ] HelloMultiLangTest %lang=cpp /b059a3fc @generic:default+builtin
[ RUN      ] HelloMultiLangTest %lang=c /ed3216b7 @generic:default+builtin
[     FAIL ] (1/2) HelloMultiLangTest %lang=cpp /b059a3fc @generic:default+builtin
==&gt; test failed during &#39;compile&#39;: test staged in &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage/generic/default/builtin/HelloMultiLangTest_b059a3fc&#39;
[       OK ] (2/2) HelloMultiLangTest %lang=c /ed3216b7 @generic:default+builtin
[----------] all spawned checks have finished

[  FAILED  ] Ran 2/2 test case(s) from 2 check(s) (1 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 13:42:48 2024
=============================================================================================================================================================================
SUMMARY OF FAILURES
-----------------------------------------------------------------------------------------------------------------------------------------------
FAILURE INFO for HelloMultiLangTest %lang=cpp (run: 1/1)
  * Description:
  * System partition: generic:default
  * Environment: builtin
  * Stage directory: /mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage/generic/default/builtin/HelloMultiLangTest_b059a3fc
  * Node list:
  * Job type: local (id=None)
  * Dependencies (conceptual): []
  * Dependencies (actual): []
  * Maintainers: []
  * Failing phase: compile
  * Rerun with &#39;-n /b059a3fc -p builtin --system generic:default -r&#39;
  * Reason: build system error: I do not know how to compile a C++ program
-----------------------------------------------------------------------------------------------------------------------------------------------
Log file(s) saved in &#39;/tmp/rfm-myh24uz1.log&#39;
</code></pre></div>
<p>You can see that the tests failed.
Before investigating the cause of the failure, let's explore the role of the
<code>lang = parameter(['c', 'cpp'])</code> definition.
The call to the <code>parameter</code> function will instantiate an object of the test class for each of the elements in its input list.
And for each object, it will set the <code>lang</code> field to the element of the list for which the object is being instantiated.</p>
<p>The instantiated tests are listed in the test output,
<div class="highlight"><pre><span></span><code>[ RUN      ] HelloMultiLangTest %lang=cpp /b059a3fc @generic:default+builtin
[ RUN      ] HelloMultiLangTest %lang=c /ed3216b7 @generic:default+builtin
</code></pre></div>
and for each test the name of the test now includes the <code>lang</code> field and its assigned value. Furthermore, if you explore the <code>output</code> or <code>staging</code> directories, you will observe that there are 2 test directories created for <code>HelloMultiLangTest</code>, one for each value of <code>lang</code>. However, the directories are differentiated by the <strong>test hash value</strong>.
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>output/generic/default/builtin
HelloMultiLangTest_b059a3fc<span class="w">  </span>HelloMultiLangTest_ed3216b7
</code></pre></div>
The hash values are used to create the test directories instead of the actual test names because the test names become unmanageable as the number of parameters increases. Use the test output or the reports in <code>~/.reframe/reports</code> to map hashes to parameter values.</p>
<p>We have seen how parameters are defined, but how is the <code>lang</code> parameter used in the <code>HelloMultiLangTest</code> test? Observe the <code>set_sourcepath</code> function. The function is decorated with the <code>@run_before('compile')</code> decorator, which as the name suggests will call the function before the compilation phase of the regression test pipeline. The function simply sets the source path of the compiled file, using the <code>lang</code> field to set the language extension. In our case this allows us to check 2 programs, one in C and another one in C++. However, it seems that the compilation of the C++ test failed.</p>
<div class="admonition question">
<p class="admonition-title">Question 5: Detecting cases in the report file</p>
<p>Run the <code>HelloMultiLangTest</code> again and find the corresponding report file.</p>
<ul>
<li>How many test cases are mentioned in the report file?</li>
<li>Note down in your report the <code>name</code> and <code>hash</code> fields for each test case.</li>
<li>Note down in your report the value of the source path option used for each test case.</li>
</ul>
</div>
<h3 id="configuring-the-environment-on-a-stand-alone-machine">Configuring the environment on a stand-alone machine</h3>
<p>The C++ test fails during the compilation phase of the regression test pipeline. The error message reported by ReFrame,
<div class="highlight"><pre><span></span><code>==&gt; test failed during &#39;compile&#39;: test staged in &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage/generic/default/builtin/HelloMultiLangTest_b059a3fc&#39;
</code></pre></div>
informs us about the phase where the test failed, and directs us to the staging directory for the test. After a failure, ReFrame retains the contents of the staging directory so that we can diagnose the cause of the problem. In this case, though the staging directory contains the source files and after some inspection, there are no obvious bugs. Let's look instead at the summary of failures printed at the end of the test.</p>
<div class="highlight"><pre><span></span><code>SUMMARY OF FAILURES
-----------------------------------------------------------------------------------------------------------------------------------------------
FAILURE INFO for HelloMultiLangTest %lang=cpp (run: 1/1)
  * Description:
  * System partition: generic:default
  * Environment: builtin
  * Stage directory: /mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage/generic/default/builtin/HelloMultiLangTest_b059a3fc
  * Node list:
  * Job type: local (id=None)
  * Dependencies (conceptual): []
  * Dependencies (actual): []
  * Maintainers: []
  * Failing phase: compile
  * Rerun with &#39;-n /b059a3fc -p builtin --system generic:default -r&#39;
  * Reason: build system error: I do not know how to compile a C++ program
-----------------------------------------------------------------------------------------------------------------------------------------------
</code></pre></div>
<p>The ReFrame program reports that it is unable to compile C++ programs. The <code>builtin</code> environment we are using to compile our programs defines only the C compiler!</p>
<p>To compile our program, we need to define an environment with a C++ compiler. The environment for an Aion cluster node is defined in <code>config/aion_node.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">site_configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;systems&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;aion_node&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Stand alone Aion node&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hostnames&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;aion-[0-9]</span><span class="si">{4}</span><span class="s1">&#39;</span><span class="p">],</span>
            <span class="s1">&#39;modules_system&#39;</span><span class="p">:</span> <span class="s1">&#39;nomod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;partitions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;scheduler&#39;</span><span class="p">:</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;launcher&#39;</span><span class="p">:</span> <span class="s1">&#39;local&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;environs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gnu&#39;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;environments&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;gnu&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;gcc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;g++&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;gfortran&#39;</span><span class="p">,</span>
            <span class="s1">&#39;target_systems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aion_node&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;clang&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;clang&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;clang++&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;target_systems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aion_node&#39;</span><span class="p">]</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>The file defines a <code>site_configuration</code>, which consists of a list of systems and a list of environments. The systems are simply the computers in our configuration where we can build and run code, and the environments are the possible compilation setups. At this point, we still consider the nodes of our HPC cluster as stand-alone machines, so we do not specify the module system and most importantly the scheduler.</p>
<p>Let's examine the components of our system configuration. First, there is a list of systems. We define a single system, <code>aion_node</code>. Important entries in the system definition are</p>
<ul>
<li>the <code>hostname</code> which describes for which hostnames the configuration will be active, and its value is a list of Python regular expressions (<a href="https://docs.python.org/3/library/re.html"><code>re</code></a>),</li>
<li>the <code>modules_system</code> which describes the module systems that can be used in the machine, and</li>
<li>the partition of our system in which we can compile code and launch jobs.</li>
</ul>
<p>Since we are considering Aion nodes as standalone systems, there is no scheduler. The <code>gnu</code> compilation environment is enabled for Aion nodes, which will provide the C, C++, and Fortran compilers installed with the operating system of Aion. We also define a compilation environment for <code>clang</code>, but we do not enable it in the <code>environs</code> of the system partition, since Clang is not installed by default on our nodes.</p>
<p>To run the tests with a given configuration use the <code>--config-file</code> flag with the configuration file as argument. This is the result of running our tests for the 'Hello, World!' programs.
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion_node.py --checkpath basics/hello/hello2.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion_node.py --checkpath basics/hello/hello2.py --run&#39;
  launched by:       gkafanas@aion-0302
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion_node.py&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello/hello2.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-1fqfvzvx.log&#39;

[==========] Running 2 check(s)
[==========] Started on Fri Mar  8 16:15:46 2024 

[----------] start processing checks
[ RUN      ] HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[ RUN      ] HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (1/2) HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (2/2) HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[----------] all spawned checks have finished

[  PASSED  ] Ran 2/2 test case(s) from 2 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 16:15:47 2024 
Log file(s) saved in &#39;/tmp/rfm-1fqfvzvx.log&#39;
</code></pre></div>
Both tests now finish successfully. The system configuration used for the test is now reported as <code>@aion_node:default+gnu</code>.</p>
<p>Up to this point, we were running the tests defined in a single file. ReFrame can run tests from multiple files and offers a number of options to customize our runs. For instance, to run all the tests in <code>basic/hello</code>, you can provide this path to the <code>--checkpath</code> option and use the <code>--recursive</code> option.
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion_node.py --checkpath basics/hello --recursive --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion_node.py --checkpath basics/hello --recursive --run&#39;
  launched by:       gkafanas@aion-0073
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion_node.py&#39;
  check search path: (R) &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-889p5pos.log&#39;

[==========] Running 3 check(s)
[==========] Started on Fri Mar  8 18:14:15 2024 

[----------] start processing checks
[ RUN      ] HelloTest /2b3e4546 @aion_node:default+gnu
[ RUN      ] HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[ RUN      ] HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (1/3) HelloTest /2b3e4546 @aion_node:default+gnu
[       OK ] (2/3) HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (3/3) HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[----------] all spawned checks have finished

[  PASSED  ] Ran 3/3 test case(s) from 3 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 18:14:17 2024 
Log file(s) saved in &#39;/tmp/rfm-889p5pos.log&#39;
</code></pre></div></p>
<p>You can also filter the tests you want to run by name using the <code>--name</code> option and a <a href="https://docs.python.org/3/library/re.html">Python regular expression</a> to filter your tests. For instance, to run only the <code>HelloMultiLangTest</code> test use the following call.</p>
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion_node.py --checkpath basics/hello --recursive --name &#39;HelloMultiLangTest&#39; --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion_node.py --checkpath basics/hello --recursive --name HelloMultiLangTest --run&#39;
  launched by:       gkafanas@aion-0073
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion_node.py&#39;
  check search path: (R) &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hello&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-ant49hjx.log&#39;

[==========] Running 2 check(s)
[==========] Started on Fri Mar  8 18:33:03 2024 

[----------] start processing checks
[ RUN      ] HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[ RUN      ] HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (1/2) HelloMultiLangTest %lang=c /ed3216b7 @aion_node:default+gnu
[       OK ] (2/2) HelloMultiLangTest %lang=cpp /b059a3fc @aion_node:default+gnu
[----------] all spawned checks have finished

[  PASSED  ] Ran 2/2 test case(s) from 2 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 18:33:04 2024 
Log file(s) saved in &#39;/tmp/rfm-ant49hjx.log&#39;
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Question 6: Composing configuration files</p>
<p>The <code>aion_node.py</code> configuration file enables us to run jobs only on a single compute node of Aion. Let's extend it to support a compute node from Aion or Iris.</p>
<ul>
<li>Create a new configuration file <code>ulhpc_node.py</code> as a copy of <code>aion_node.py</code>.</li>
<li>Create a new system entry for Iris nodes. Note down the new system configuration in your report.</li>
<li>Replace the pattern for Aion node hostnames (<code>r'aion-[0-9]{4}'</code>) with another regular expression. The regular expression does not have to be equivalent to the existing one, just to capture the hostnames of Aion nodes. Note down the new pattern in your report.</li>
<li>Add the new <code>ulhpc_node.py</code> to your GitHub Classroom repository.</li>
</ul>
<p>Note: To find the right matching pattern, check the documentation for <a href="https://docs.python.org/3/library/re.html">Python regular expressions</a> or the <a href="https://www.geeksforgeeks.org/python-regex-cheat-sheet">Python Regex Cheat Sheet</a>.</p>
</div>
<h3 id="configuring-the-environment-on-a-cluster">Configuring the environment on a cluster</h3>
<p>We have run tests for a local computer. Now, we would like to ReFrame to run the tests on the HPC cluster, taking advantage of SLURM and the modules. Have a look at the new configuration in <code>config/aion.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">site_configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;systems&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;aion&#39;</span><span class="p">,</span>
            <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Aion cluster&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hostnames&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;aion-[0-9]</span><span class="si">{4}</span><span class="s1">&#39;</span><span class="p">],</span>
            <span class="s1">&#39;modules_system&#39;</span><span class="p">:</span> <span class="s1">&#39;lmod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;partitions&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;batch&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;descr&#39;</span><span class="p">:</span> <span class="s1">&#39;Aion compute nodes&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;scheduler&#39;</span><span class="p">:</span> <span class="s1">&#39;slurm&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;launcher&#39;</span><span class="p">:</span> <span class="s1">&#39;srun&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;access&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;--partition=batch&#39;</span><span class="p">,</span> <span class="s1">&#39;--qos=normal&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;max_jobs&#39;</span><span class="p">:</span>  <span class="mi">8</span><span class="p">,</span>
                    <span class="s1">&#39;environs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;gnu&#39;</span><span class="p">,</span> <span class="s1">&#39;builtin&#39;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;environments&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;gnu&#39;</span><span class="p">,</span>
            <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;toolchain/foss/2020b&#39;</span><span class="p">],</span>
            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;gcc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;g++&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;gfortran&#39;</span><span class="p">,</span>
            <span class="s1">&#39;target_systems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aion&#39;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;builtin&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;gcc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cxx&#39;</span><span class="p">:</span> <span class="s1">&#39;g++&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ftn&#39;</span><span class="p">:</span> <span class="s1">&#39;gfortran&#39;</span><span class="p">,</span>
            <span class="s1">&#39;target_systems&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aion&#39;</span><span class="p">]</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>This configuration file allows ReFrame to submit jobs on the cluster to execute the tests. The important components of the specifications are</p>
<ul>
<li>the module system, <code>lmod</code>, is defined for our configuration and corresponds to <a href="https://hpc-docs.uni.lu/environment/modules/">the module system supported in Aion</a>, and</li>
<li>the compilation environment <code>gnu</code>, which now uses the <code>toolchain/foss/2020b</code> module to compile our source code.</li>
</ul>
<p>We have also defined a <code>builtin</code> compilation environment that uses the compiler of the operating system, but <code>toolchain/foss/2020b</code> provides more compilers and other packages and has more up-to-date compiler versions installed.</p>
<p>Our example uses the test definitions in the <code>basics/hellomp</code>. The first definition is <code>basics/hellomp/hellomp1.py</code>.
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">reframe</span> <span class="k">as</span> <span class="nn">rfm</span>
<span class="kn">import</span> <span class="nn">reframe.utility.sanity</span> <span class="k">as</span> <span class="nn">sn</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">HelloThreadedTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">sourcepath</span> <span class="o">=</span> <span class="s1">&#39;hello_threads.cpp&#39;</span>
    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;SingleSource&#39;</span>
    <span class="n">executable_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;16&#39;</span><span class="p">]</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_compilation_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cxxflags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-std=c++11&#39;</span><span class="p">,</span> <span class="s1">&#39;-Wall&#39;</span><span class="p">]</span>
        <span class="n">environ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_environ</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">environ</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;builtin&#39;</span><span class="p">,</span> <span class="s1">&#39;gnu&#39;</span><span class="p">}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cxxflags</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-pthread&#39;</span><span class="p">]</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_computational_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">system</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_system</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">{</span><span class="s1">&#39;aion&#39;</span><span class="p">}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--time=00:05:00&#39;</span><span class="p">,</span> <span class="s1">&#39;--nodes=1&#39;</span><span class="p">,</span> <span class="s1">&#39;--ntasks-per-node=1&#39;</span><span class="p">,</span> <span class="s1">&#39;--cpus-per-task=16&#39;</span><span class="p">]</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, World\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
This is a test for a multithreaded version of the 'Hello, World!' program, where each thread prints a greeting. It will be tested on all compilation environments in our configuration file.</p>
<ul>
<li>For the compilation environments <code>builtin</code> and <code>gnu</code> the test sets the <code>-pthread</code> compilation flag.</li>
<li>For the execution in the cluster the test explicitly sets the flags <code>--time</code>, <code>--nodes</code>, <code>--ntasks-per-node</code>, and <code>--cpus-per-task</code>. The flags <code>--partition</code> and <code>--qos</code> are inherited from the system configuration and are set implicitly.</li>
</ul>
<div class="admonition question">
<p class="admonition-title">Question 7: Composing configuration files for a cluster</p>
<p>The configuration file <code>aion.py</code> targets the Aion cluster. Create a configuration file <code>ulhpc.py</code> that targets both Aion and Iris systems.
Add the configuration file to your GitHub Classroom repository.</p>
</div>
<h4 id="executing-the-tests">Executing the tests</h4>
<p>Execute the tests as usual.
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion.py --checkpath basics/hellomp/hellomp1.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion.py --checkpath basics/hellomp/hellomp1.py --run&#39; 
  launched by:       gkafanas@aion-0034
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion.py&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/hellomp/hellomp1.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-o6oz0qqw.log&#39;

[==========] Running 1 check(s)
[==========] Started on Fri Mar  8 21:57:34 2024

[----------] start processing checks
[ RUN      ] HelloThreadedTest /a6fa300f @aion:batch+gnu
[ RUN      ] HelloThreadedTest /a6fa300f @aion:batch+builtin
[       OK ] (1/2) HelloThreadedTest /a6fa300f @aion:batch+builtin
[       OK ] (2/2) HelloThreadedTest /a6fa300f @aion:batch+gnu
[----------] all spawned checks have finished

[  PASSED  ] Ran 2/2 test case(s) from 1 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 21:57:39 2024
Log file(s) saved in &#39;/tmp/rfm-o6oz0qqw.log&#39;
</code></pre></div></p>
<p>We can see that 2 tests were executed, one for each compilation environment. Let's investigate the resulting scripts for each phase.</p>
<h4 id="the-compilation-script">The compilation script</h4>
<p>You can find the compilation script in the <code>output</code> directory as usual. Open the compilation script <code>output/aion/batch/gnu/HelloThreadedTest/rfm_build.sh</code> for the <code>gnu</code> environment.
<div class="highlight"><pre><span></span><code>#!/bin/bash

_onerror()
{
    exitcode=$?
    echo &quot;-reframe: command \`$BASH_COMMAND&#39; failed (exit code: $exitcode)&quot;
    exit $exitcode
}

trap _onerror ERR

module load toolchain/foss/2020b
g++ -std=c++11 -Wall -pthread hello_threads.cpp -o ./HelloThreadedTest
</code></pre></div>
We observe that module <code>toolchain/foss/2020b</code> is loaded in the environment before the compilation, but the compilation was executed locally. Next, have a look at <code>output/aion/batch/builtin/HelloThreadedTest/rfm_build.sh</code>, the compilation script for the <code>builtin</code> environment.
<div class="highlight"><pre><span></span><code>#!/bin/bash

_onerror()
{
    exitcode=$?
    echo &quot;-reframe: command \`$BASH_COMMAND&#39; failed (exit code: $exitcode)&quot;
    exit $exitcode
}

trap _onerror ERR

g++ -std=c++11 -Wall -pthread hello_threads.cpp -o ./HelloThreadedTest
</code></pre></div>
The only difference between <code>gnu</code> and <code>builtin</code> is that the toolchain module is not loaded and thus the system compiler is used instead.</p>
<h4 id="the-execution-script">The execution script</h4>
<p>Open the execution script, <code>output/aion/batch/gnu/HelloThreadedTest/rfm_job.sh</code>, corresponding to the <code>gnu</code> compilation environment.
<div class="highlight"><pre><span></span><code>#!/bin/bash
#SBATCH --job-name=&quot;rfm_HelloThreadedTest&quot;
#SBATCH --ntasks=1
#SBATCH --output=rfm_job.out
#SBATCH --error=rfm_job.err
#SBATCH --partition=batch
#SBATCH --qos=normal
#SBATCH --time=00:05:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=16
module load toolchain/foss/2020b
srun ./HelloThreadedTest 16
</code></pre></div></p>
<p>This is a simple batch script that executes our compiled program on 16 cores, corresponding to a full socket of an Aion compute node. Note that the modules used in the compilation are loaded automatically. Now browse the execution script <code>output/aion/batch/builtin/HelloThreadedTest/rfm_job.sh</code> for the <code>builtin</code> environment.
<div class="highlight"><pre><span></span><code>#!/bin/bash
#SBATCH --job-name=&quot;rfm_HelloThreadedTest&quot;
#SBATCH --ntasks=1
#SBATCH --output=rfm_job.out
#SBATCH --error=rfm_job.err
#SBATCH --partition=batch
#SBATCH --qos=normal
#SBATCH --time=00:05:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=16
srun ./HelloThreadedTest 16
</code></pre></div>
The execution command for the <code>builtin</code> and <code>gnu</code> compilation environments is identical, except that there is no module loaded in the <code>builtin</code> environment.</p>
<p>In general, ReFrame generates the job shell scripts using the following pattern:
<div class="highlight"><pre><span></span><code>#!/bin/bash -l
{job_scheduler_preamble}
{prepare_cmds}
{env_load_cmds}
{prerun_cmds}
{parallel_launcher} {executable} {executable_opts}
{postrun_cmds}
</code></pre></div>
You can find more configuration options for the job script in the <a href="https://reframe-hpc.readthedocs.io/en/stable/tutorial_advanced.html#customizing-the-test-job-script">official tutorial</a>.</p>
<div class="admonition info">
<p class="admonition-title">Compiling test executables in a cluster</p>
<p>Note that the test executable is compiled in the node where ReFrame is launched. After the compilation, multiple tests can then be launched in parallel if a scheduler is available. ReFrame is designed to handle multiple sanity and performance tests for each executable that require significantly more time than the compilation of the executable. You can find more details in the <a href="https://reframe-hpc.readthedocs.io/en/stable/pipeline.html">documentation</a> for the test pipelines.</p>
<p>To compile and test multiple executables in parallel, we need to launch multiple instances of ReFrame. If a scheduler is available multiple runs of ReFrame can be scheduled as independent jobs.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Question 8: Composing tests for a cluster</p>
<p>The multithreaded "Hello, World!" test was designed to run with 16 threads. Modify the test in <code>basics/hellomp/hellomp1.py</code> to run with 8 and 32 threads.
You should use the parametric syntax for ReFrame as explained earlier in the example <code>basics/hello/hello2.py</code>.</p>
<p>Submit the modified test file in your Github Classroom repository.</p>
</div>
<hr />
<h2 id="part-4-advanced-sanity-checks">ðŸ”µ Part 4: Advanced sanity checks</h2>
<p>Let's observe the output generated for our test in the <code>gnu</code> compilation environment stored in the <code>output/aion/batch/gnu/HelloThreadedTest/rfm_job.out</code> file.
<div class="highlight"><pre><span></span><code>[[ 0] Hello, World!
 [ 12] Hello, World!
] Hello, World!
[ 3] Hello, World!
[ 4] Hello, World!
[ 5] Hello, World!
[ 6] Hello, World!
[ 7] Hello, World!
[ 8] Hello, World!
[ 9] Hello, World!
[10] Hello, World!
[11] Hello, World!
[12] Hello, World!
[13] Hello, World!
[14] Hello, World!
[15] Hello, World!
</code></pre></div>
This is not the intended output, but our test still succeeds! As mentioned previously, our sanity check simply checks for the occurrence of the phrase 'Hello, World!' in the output.
<div class="highlight"><pre><span></span><code><span class="nd">@sanity_function</span>
<span class="k">def</span> <span class="nf">assert_hello</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Hello, World\!&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div></p>
<p>To rectify our regression test we use the following sanity check, which looks for exactly 16 occurrences of the greeting.
<div class="highlight"><pre><span></span><code><span class="nd">@sanity_function</span>
<span class="k">def</span> <span class="nf">assert_num_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">num_messages</span> <span class="o">=</span> <span class="n">sn</span><span class="o">.</span><span class="n">len</span><span class="p">(</span><span class="n">sn</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[\s?\d+\] Hello, World\!&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_eq</span><span class="p">(</span><span class="n">num_messages</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</code></pre></div></p>
<p>The code for the new sanity check is found in <code>basics/hellomp/hellomp2.py</code>. Running the test with the command:
<div class="highlight"><pre><span></span><code>reframe<span class="w"> </span>--config-file<span class="w"> </span>config/aion.py<span class="w"> </span>--checkpath<span class="w"> </span>basics/hellomp/hellomp2.py<span class="w"> </span>--run
</code></pre></div>
You should get an error reporting the mismatched output.</p>
<div class="admonition info">
<p class="admonition-title">Tests failing or not failing? This is a Race Condition bug!</p>
<p>If you repeat the test multiple times, you can notice that sometimes the tests pass, and sometimes they fail.
This is a typical example of a <strong>race condition</strong> that is a time-dependent error (cf our Lecture on Debugging).
Automatic testing testing that is repeated many times is usually crucial to detect this type of errors.</p>
<p>For this specific program, we have different threads that are printing an output message all at the same time.
Depending on how the threads are scheduled on the computing cores by the operating system, the message might be interleaved or not.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Question 9: Repeating sanity checks to catch non-deterministic errors</p>
<p>Reframe offers 2 options for repeating a test multiple times in order to catch non-deterministic errors, <code>--repeat</code> and <code>--rerun</code>.</p>
<ul>
<li>With the <code>--repeat</code>, each test is repeated a given number of times.</li>
<li>With the <code>--rerun</code>, the whole test session is rerun a given number of times.</li>
</ul>
<p><strong>Your task:</strong></p>
<ul>
<li>
<p>Edit <code>basics/hellomp/hellomp2.py</code> to run 2 parallel threads to make the race condition harder to detect. Then use either <code>--rerun</code> or <code>--repeat</code> to run the test 8 times.
Were all tests successful? Were you able to catch the race condition?</p>
</li>
<li>
<p>Add the ReFrame report files for your run from <code>~/.reframe/reports</code> to your GitHub Classroom repository.</p>
</li>
</ul>
<p>Note: You should be able to detect the race condition. But don't worry if you don't, because it is a random process.</p>
</div>
<p>This <strong>race condition</strong> problem in our code can be rectified by activating the use of the mutex with the flag <code>SYNC_MESSAGES</code>.
We tell ReFrame to inject this flag in the compilation command line by adding the following line to the test specification (cf new file <code>basics/hellomp/hellomp3.py</code>).
<div class="highlight"><pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cppflags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-DSYNC_MESSAGES&#39;</span><span class="p">]</span>
</code></pre></div>
Run the new test to ensure that the problem is fixed.</p>
<hr />
<h2 id="part-5-performance-testing">ðŸ”µ Part 5: Performance testing</h2>
<p>Up to this point, we have tried sanity checks, however, ReFrame also allows us to define <strong>performance regression checks</strong>. During development, programmers are usually focused on correctness. As a result, while most correctness errors are detected and fixed relatively early, subtle degradation in performance as more functionality is added is usually hard to detect. Regularly testing a code base with ReFrame performance tests is a great way to track the performance of your code base.</p>
<p>We will test the performance of a simple program writing and reading from a stream. The test files are located in the directory <code>basics/stream</code>. We implement the same set of tests in an increasingly more sophisticated manner. Open the file <code>basics/stream/stream1.py</code> first. There is a single test called <code>StreamTest</code> defined, with 4 performance measurements.</p>
<ul>
<li>Performance measurement tests inherit from the <code>reframe.RegressionTest</code> class which defines a dictionary <code>perf_variables</code> that maps test names to test definitions. The tests are actually classes, and after the execution of the test, they also store the test results.</li>
<li>Performance measures are defined in functions decorated with the <code>@performance_function</code> decorator which takes as inputs the units of measurement and other parameters that are optional. If you provide the <code>perf_key</code> parameter, its value will be used as the key for the test in the <code>perf_variables</code> dictionary, otherwise, the function name is used by default.</li>
</ul>
<p>Consider for instance the test measuring the copy speed:
<div class="highlight"><pre><span></span><code><span class="nd">@performance_function</span><span class="p">(</span><span class="s1">&#39;MB/s&#39;</span><span class="p">,</span> <span class="n">perf_key</span><span class="o">=</span><span class="s1">&#39;Copy&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">extract_copy_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">extractsingle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Copy:\s+(\S+)\s+.*&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</code></pre></div>
A unit of measurement must be provided as the first argument to the generator, in this case, <code>'MB/s'</code>. The actual value for the test measurement is extracted from the output of the tested executable. The performance measurement function uses the <em>deferrable function</em> <a href="https://reframe-hpc.readthedocs.io/en/stable/deferrable_functions_reference.html#reframe.utility.sanity.extractsingle"><code>extractsingle</code></a> which extracts a single value from a line containing the given pattern and converts it to a <code>float</code> according to argument 4.</p>
<h3 id="executing-performance-tests">Executing performance tests</h3>
<p>Performance tests are run similarly to sanity checks. In the case of the stream test for instance:
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion.py --checkpath basics/stream/stream1.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion.py --checkpath basics/stream/stream1.py --run&#39;
  launched by:       gkafanas@aion-0019
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion.py&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/basics/stream/stream1.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/reframe/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-yn3itbkl.log&#39;

[==========] Running 1 check(s)
[==========] Started on Fri Mar  8 23:29:55 2024

[----------] start processing checks
[ RUN      ] StreamTest /cdf4820d @aion:batch+gnu
[       OK ] (1/1) StreamTest /cdf4820d @aion:batch+gnu
P: Copy: 22771.9 MB/s (r:0, l:None, u:None)
P: Scale: 22880.7 MB/s (r:0, l:None, u:None)
P: Add: 25043.7 MB/s (r:0, l:None, u:None)
P: Triad: 25085.8 MB/s (r:0, l:None, u:None)
[----------] all spawned checks have finished

[  PASSED  ] Ran 1/1 test case(s) from 1 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar  8 23:30:03 2024
Log file(s) saved in &#39;/tmp/rfm-yn3itbkl.log&#39;
</code></pre></div>
After each test, the performance results are also reported:
<div class="highlight"><pre><span></span><code>P: Copy: 22771.9 MB/s (r:0, l:None, u:None)
P: Scale: 22880.7 MB/s (r:0, l:None, u:None)
P: Add: 25043.7 MB/s (r:0, l:None, u:None)
P: Triad: 25085.8 MB/s (r:0, l:None, u:None)
</code></pre></div>
You can add the parameter flag <code>--performance-report</code> at the call to <code>reframe</code> to print a detailed report of the performance analysis at the end of tests.</p>
<h3 id="adding-performance-reference-values">Adding performance reference values</h3>
<p>The ReFrame performance test definitions are enough to extract performance measurements, but without any context, we can not interpret the resulting values.
Typically in regression testing, we would like our tests to report when the performance of our program deviates significantly from some expected values. Reference values for our tests are defined using the <code>reference</code> field:
<div class="highlight"><pre><span></span><code><span class="n">reference</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;aion&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Copy&#39;</span><span class="p">:</span>  <span class="p">(</span><span class="mi">33000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Scale&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15500</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Add&#39;</span><span class="p">:</span>   <span class="p">(</span><span class="mi">16000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Triad&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;MB/s&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
The reference field is a dictionary that defines for each system configuration the expected values for each performance measurement, and the acceptable deviation on either side. Use <code>None</code> if you would like to avoid checking whether the performance exceeds either of the limits.</p>
<div class="admonition question">
<p class="admonition-title">Question 10: Using performance tests with references</p>
<p>You will find in the tutorial directory the file <code>basics/stream/stream2.py</code>. The test file contains reference performance values for the single-threaded stream benchmark on Aion.</p>
<ul>
<li>
<p>Convert the benchmark to multithreaded by replacing the class variable definition,
<div class="highlight"><pre><span></span><code><span class="n">env_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OMP_PLACES&#39;</span><span class="p">:</span> <span class="s1">&#39;cores&#39;</span>
<span class="p">}</span>
</code></pre></div>
with:
<div class="highlight"><pre><span></span><code><span class="n">env_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">:</span> <span class="s1">&#39;16&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OMP_PLACES&#39;</span><span class="p">:</span> <span class="s1">&#39;cores&#39;</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p>Run the test again, provide a screenshot of the ReFrame output, and explain based on the output whether the test failed or succeeded.</p>
</li>
<li>
<p>Update the reference values for the <code>aion</code> configuration, to ensure that the reference corresponds to a multithreaded test. Now your test should succeed. Provide a screenshot of the ReFrame output in your report.</p>
</li>
</ul>
</div>
<hr />
<h2 id="part-6-integration-with-build-systems">ðŸ”µ Part 6: Integration with build systems</h2>
<p>Up to this point, we encountered single source programs that ReFrame compiles with a few direct compilation commands. Programs that involve multiple source files or elaborate linking dependencies, cannot be handled so easily with ReFrame. Luckily, ReFrame provides options to call various build automation systems. The build systems are categorized broadly by ReFrame in</p>
<ul>
<li>build automation systems, such as Make, CMake, and Autotools, and</li>
<li>source code-based package managers such as EasyBuild and Spack.</li>
</ul>
<p>The main difference between the 2 categories is that source code base package managers automate the installation of all dependencies, whereas build automation systems require manual handling of dependencies which can be laborious when testing a piece of software in a large number of platforms.</p>
<h3 id="compiling-the-source-code-with-makefile-scripts">Compiling the source code with Makefile scripts</h3>
<p>You can find an example test of a program compiled with Makefiles in <code>advanced/makefile</code>. The tests are defined in the file <code>advanced/makefiles/maketest.py</code>.</p>
<details class="info">
<summary>Test definitions in <code>advanced/makefiles/maketest.py</code></summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">reframe</span> <span class="k">as</span> <span class="nn">rfm</span>
<span class="kn">import</span> <span class="nn">reframe.utility.sanity</span> <span class="k">as</span> <span class="nn">sn</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">MakefileTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
    <span class="n">elem_type</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">([</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">])</span>

    <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;Test demonstrating use of Makefiles&#39;</span>
    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;builtin&#39;</span><span class="p">,</span> <span class="s1">&#39;gnu&#39;</span><span class="p">]</span>
    <span class="n">executable</span> <span class="o">=</span> <span class="s1">&#39;./dotprod&#39;</span>
    <span class="n">executable_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;100000&#39;</span><span class="p">]</span>
    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;Make&#39;</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_compiler_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cppflags</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;-DELEM_TYPE=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">validate_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Result \(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_type</span><span class="si">}</span><span class="s1">\):&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">MakeOnlyTest</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">CompileOnlyRegressionTest</span><span class="p">):</span>
    <span class="n">elem_type</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">([</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">])</span>
    <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;Test demonstrating use of Makefiles&#39;</span>
    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;builtin&#39;</span><span class="p">,</span> <span class="s1">&#39;gnu&#39;</span><span class="p">]</span>
    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;Make&#39;</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_compiler_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">cppflags</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;-DELEM_TYPE=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">elem_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">validate_compilation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_not_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</code></pre></div>
</details>
<ul>
<li>The parameter <code>build_system</code> is used to select the 'Make' build option.</li>
<li>With the <code>build_system</code> set to 'Make', the <code>src/Makefile</code> will be used to compile the executable.</li>
</ul>
<p>Execute the tests:</p>
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion.py --checkpath advanced/makefiles/maketest.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion.py --checkpath advanced/makefiles/maketest.py --run&#39;
  launched by:       gkafanas@aion-0336
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion.py&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/advanced/makefiles/maketest.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-hcpmjmq2.log&#39;

[==========] Running 4 check(s)
[==========] Started on Fri Mar 15 19:30:54 2024

[----------] start processing checks
[ RUN      ] MakeOnlyTest %elem_type=double /1f34b084 @aion:batch+gnu
[ RUN      ] MakeOnlyTest %elem_type=float /dde8bef0 @aion:batch+gnu
[ RUN      ] MakefileTest %elem_type=double /1fe42bc0 @aion:batch+gnu
[ RUN      ] MakefileTest %elem_type=float /56e65399 @aion:batch+gnu
[       OK ] (1/4) MakeOnlyTest %elem_type=double /1f34b084 @aion:batch+gnu
[       OK ] (2/4) MakeOnlyTest %elem_type=float /dde8bef0 @aion:batch+gnu
[       OK ] (3/4) MakefileTest %elem_type=double /1fe42bc0 @aion:batch+gnu
[       OK ] (4/4) MakefileTest %elem_type=float /56e65399 @aion:batch+gnu
[----------] all spawned checks have finished

[  PASSED  ] Ran 4/4 test case(s) from 4 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar 15 19:31:10 2024
Log file(s) saved in &#39;/tmp/rfm-hcpmjmq2.log&#39;
</code></pre></div>
<p>The important files in this case are the compilation files. Open the compilation file <code>output/aion/batch/gnu/MakefileTest_1fe42bc0/rfm_build.sh</code> for the <code>gnu</code> environment.</p>
<details class="info">
<summary>Contents of <code>output/aion/batch/gnu/MakefileTest_1fe42bc0/rfm_build.sh</code> compilation script</summary>
<div class="highlight"><pre><span></span><code>#!/bin/bash

_onerror()
{
    exitcode=$?
    echo &quot;-reframe: command \`$BASH_COMMAND&#39; failed (exit code: $exitcode)&quot;
    exit $exitcode
}

trap _onerror ERR

module load toolchain/foss/2020b
make -j 1 CC=&quot;gcc&quot; CXX=&quot;g++&quot; FC=&quot;gfortran&quot; NVCC=&quot;nvcc&quot; CPPFLAGS=&quot;-DELEM_TYPE=double&quot;
</code></pre></div>
</details>
<p>We observe that</p>
<ul>
<li><code>make</code> was used to compile our executable,</li>
<li>compiler options and other flags, such as <code>ELEM_TYPE</code> are set by ReFrame in Makefile variables, and</li>
<li>any dependencies must be available in the environment when compiling the program.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Compile only regression tests</p>
<p>This example demonstrates a new type of test, the <code>CompileOnlyRegressionTest</code>. These tests examine only the compilation output, they do not launch the resulting executable. In our case, the test <code>validate_compilation</code> simply ensures that no warnings were generated during the compilation.</p>
<p>Compile-only tests are very useful in reporting errors when analyzing the code with <a href="https://en.wikipedia.org/wiki/Lint_(software)">static code analyzers</a>.</p>
</div>
<h3 id="compiling-with-source-code-package-manager-systems">Compiling with source code package manager systems</h3>
<p>Build automation scripts can build any piece of code, but they assume that all the required dependencies will be available at build and run time. When dependencies are not available as system packages or modules, we can use source code package managers, that build and install all required dependencies locally as modules before building our software.</p>
<p>An example using EasyBuild is located in <code>advanced/easybuild</code>. Our test directory contains only the file with the test definitions.</p>
<details class="info">
<summary>Contents of <code>advanced/easybuild/eb_test.py</code></summary>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">reframe</span> <span class="k">as</span> <span class="nn">rfm</span>
<span class="kn">import</span> <span class="nn">reframe.utility.sanity</span> <span class="k">as</span> <span class="nn">sn</span>

<span class="nd">@rfm</span><span class="o">.</span><span class="n">simple_test</span>
<span class="k">class</span> <span class="nc">BZip2EBCheck</span><span class="p">(</span><span class="n">rfm</span><span class="o">.</span><span class="n">RegressionTest</span><span class="p">):</span>
    <span class="n">descr</span> <span class="o">=</span> <span class="s1">&#39;Demo test using EasyBuild to build the test code&#39;</span>
    <span class="n">valid_systems</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
    <span class="n">valid_prog_environs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;builtin&#39;</span><span class="p">]</span>
    <span class="n">executable</span> <span class="o">=</span> <span class="s1">&#39;bzip2&#39;</span>
    <span class="n">executable_opts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--help&#39;</span><span class="p">]</span>
    <span class="n">build_system</span> <span class="o">=</span> <span class="s1">&#39;EasyBuild&#39;</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;compile&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setup_build_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">easyconfigs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bzip2-1.0.6.eb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-f&#39;</span><span class="p">]</span>

    <span class="nd">@run_before</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">prepare_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_system</span><span class="o">.</span><span class="n">generated_modules</span>

    <span class="nd">@sanity_function</span>
    <span class="k">def</span> <span class="nf">assert_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sn</span><span class="o">.</span><span class="n">assert_found</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Version 1.0.6&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</code></pre></div>
</details>
<ul>
<li>The parameter <code>build_system</code> is used to select the 'EasyBuild' build option.</li>
<li>Instead of a directory with source code, a list of easyconfig files is specified with the <code>build_system.easyconfigs</code> field.</li>
</ul>
<p>Ensure that EasyBuild is accessible in your path, and run the test:
<div class="highlight"><pre><span></span><code>$ reframe --config-file config/aion.py --checkpath advanced/easybuild/eb_test.py --run
[ReFrame Setup]
  version:           4.3.3
  command:           &#39;/home/users/gkafanas/.local/easybuild/aion/2020b/epyc/software/ReFrame/4.3.3/bin/reframe --config-file config/aion.py --checkpath advanced/easybuild/eb_test.py --run&#39;
  launched by:       gkafanas@aion-0336
  working directory: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials&#39;
  settings files:    &#39;&lt;builtin&gt;&#39;, &#39;config/aion.py&#39;
  check search path: &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/advanced/easybuild/eb_test.py&#39;
  stage directory:   &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage&#39;
  output directory:  &#39;/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/output&#39;
  log files:         &#39;/tmp/rfm-raoymwru.log&#39;

[==========] Running 1 check(s)
[==========] Started on Fri Mar 15 19:36:14 2024

[----------] start processing checks
[ RUN      ] BZip2EBCheck /f4d96bd6 @aion:batch+builtin
[       OK ] (1/1) BZip2EBCheck /f4d96bd6 @aion:batch+builtin
[----------] all spawned checks have finished

[  PASSED  ] Ran 1/1 test case(s) from 1 check(s) (0 failure(s), 0 skipped, 0 aborted)
[==========] Finished on Fri Mar 15 19:36:25 2024
Log file(s) saved in &#39;/tmp/rfm-raoymwru.log&#39;
</code></pre></div></p>
<p>The tests were executed successfully. Observing the contents of the compilation file <code>output/aion/batch/builtin/BZip2EBCheck/rfm_build.sh</code>,
<div class="highlight"><pre><span></span><code>#!/bin/bash

_onerror()
{
    exitcode=$?
    echo &quot;-reframe: command \`$BASH_COMMAND&#39; failed (exit code: $exitcode)&quot;
    exit $exitcode
}

trap _onerror ERR

export EASYBUILD_BUILDPATH=/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage/aion/batch/builtin/BZip2EBCheck/easybuild/build
export EASYBUILD_INSTALLPATH=/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage/aion/batch/builtin/BZip2EBCheck/easybuild
export EASYBUILD_PREFIX=/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage/aion/batch/builtin/BZip2EBCheck/easybuild
export EASYBUILD_SOURCEPATH=/mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage/aion/batch/builtin/BZip2EBCheck/easybuild
eb bzip2-1.0.6.eb -f
</code></pre></div>
we can see that a module was compiled with EasyBuild and stored in the staging directory. During test execution, the compiled module was loaded to provide the test executable:
<div class="highlight"><pre><span></span><code>#!/bin/bash
#SBATCH --job-name=&quot;rfm_BZip2EBCheck&quot;
#SBATCH --ntasks=1
#SBATCH --output=rfm_job.out
#SBATCH --error=rfm_job.err
#SBATCH --partition=batch
#SBATCH --qos=normal
module use /mnt/irisgpfs/users/gkafanas/tutorials/ReFrame/W05-Testing_on_HPC/tutorials/stage/aion/batch/builtin/BZip2EBCheck/easybuild/modules/all
module load tools/bzip2/1.0.6
srun bzip2 --help
</code></pre></div>
Any dependencies of our test program, <code>bzip2</code>, were compiled and installed as modules, and are thus available when loading the <code>bzip2</code> module.</p>
<hr />
<h2 id="report-submission">ðŸ”µ Report submission</h2>
<p>Don't forget to add and push all the required files to your GitHub Classroom repository:</p>
<ul>
<li>the log files and the configuration files ;</li>
<li>the report, including the answers to all the questions and the screenshots.</li>
</ul>
<p>Don't add any other files and directories (for example, build directories, executables, Makefile, etc.).
Finalize your report and save it as a PDF (no other format allowed!) in the <code>report</code> sub-directory of your GitHub Classroom repository.</p>
<details class="tip">
<summary>Uploading your report</summary>
<p>You don't need to copy it to the HPC to upload your report. Instead, you can use the <strong>Add file</strong> button directly on the GitHub webpage.</p>
</details>
<div class="admonition danger">
<p class="admonition-title">Files Submission</p>
<p>Your files and report are considered submitted once they are pushed to your repository.</p>
<p>Check your GitHub repository online to make sure:
<a href="https://github.com/MHPC-HPCSoftwareEnvironment/w05-testing-on-hpc-XXX">https://github.com/MHPC-HPCSoftwareEnvironment/w05-testing-on-hpc-XXX</a></p>
<p>Passed the deadline at <strong>25/03/2024 23h59</strong> you won't be able to push anymore.</p>
</div>
<hr />
<h2 id="additional-resources">ðŸ”µ Additional Resources</h2>
<h3 id="about-reframe">About ReFrame</h3>
<ul>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/index.html">ReFrame Documentation</a></li>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/manpage.html">ReFrame Command Line Reference</a></li>
<li><a href="https://reframe-hpc.readthedocs.io/en/stable/tutorial_basics.html">ReFrame Tutorial</a></li>
</ul>
<h3 id="about-python-regular-expressions">About Python Regular Expressions</h3>
<ul>
<li><a href="https://docs.python.org/3/library/re.html">Python Documentation on <code>re</code>: Regular expression operations</a></li>
<li><a href="https://www.geeksforgeeks.org/python-regex-cheat-sheet">Regex Cheat Sheet â€“ Python</a></li>
<li><a href="https://images.datacamp.com/image/upload/v1665049611/Marketing/Blog/Regular_Expressions_Cheat_Sheet.pdf">Regular Expressions Cheat Sheet</a></li>
<li><a href="https://regex101.com/">regex101: build, test, and debug regex</a></li>
</ul>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>